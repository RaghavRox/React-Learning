{"version":3,"sources":["index.js"],"names":["firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","firestore","pc","RTCPeerConnection","iceServers","urls","iceCandidatePoolSize","localStream","remoteStream","MediaStream","MyVideo","props","vidRef","React","createRef","this","startStream","a","navigator","mediaDevices","getUserMedia","video","audio","getTracks","forEach","track","addTrack","displayLocalStream","current","srcObject","play","ref","width","height","Component","RemoteVideo","ontrack","event","streams","setInterval","GenerateCall","state","output","generateCall","bind","callDoc","collection","doc","offerCandidates","answerCandidates","setState","id","onicecandidate","candidate","add","toJSON","createOffer","offerDescription","setLocalDescription","offer","sdp","type","set","onSnapshot","snapshot","data","currentRemoteDescription","answer","answerDescription","RTCSessionDescription","setRemoteDescription","docChanges","change","RTCIceCandidate","addIceCandidate","onClick","JoinCall","handleChange","answerCall","target","value","callId","get","callData","createAnswer","update","console","log","onChange","App","firebase","apps","length","initializeApp","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4403cd69.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport firebase from 'firebase/app'\nimport 'firebase/firestore';\nimport './index.css';\n\n\n\n// class Wa extends React.Component{\n//   constructor(props){\n//     super(props);\n//     this.state = {number : null};\n\n//     this.handleSubmit = this.handleSubmit.bind(this);\n//     this.handleChange = this.handleChange.bind(this);\n\n//   }\n\n  \n\n//   handleSubmit(event){\n//     window.location.href = \"https://wa.me/91\"+this.state.number;\n//     event.preventDefault();\n//   } \n\n//   handleChange(event){\n//     this.setState({number : event.target.value});\n//   }\n\n//   render(){\n//     return (\n//       <form onSubmit = {this.handleSubmit}>\n//           <label>\n//             number : <input type =\"text\" value = {this.state.number} onChange = {this.handleChange}/>\n//           </label>\n//           <input type = \"submit\" value = \"chat in whatsapp\"/>\n//       </form>\n//     );\n//   }\n// }\n\n\n//Global variables\nconst firebaseConfig = {\n  apiKey: \"AIzaSyBTp6wE7s53_l8p_NlK85MawnVkaE-Nskw\",\n  authDomain: \"react-learning-b601c.firebaseapp.com\",\n  projectId: \"react-learning-b601c\",\n  storageBucket: \"react-learning-b601c.appspot.com\",\n  messagingSenderId: \"204682177164\",\n  appId: \"1:204682177164:web:feef8528c6d49558ef29a9\",\n  measurementId: \"G-N7KP9MCCZ7\"\n};\nconst servers = {\n  iceServers: [\n    {\n      urls: ['stun:stun1.l.google.com:19302', 'stun:stun2.l.google.com:19302'],\n    },\n  ],\n  iceCandidatePoolSize: 10,\n};\nlet firestore = null;\nlet pc = new RTCPeerConnection(servers);\nlet localStream = null;\nlet remoteStream = new MediaStream();\n\n\n\n\nclass MyVideo extends React.Component{\n  constructor(props){\n    super(props);\n    this.vidRef = React.createRef();\n  }\n\n  componentDidMount(){\n    this.startStream();\n  }\n\n  async startStream(){\n    localStream = await navigator.mediaDevices.getUserMedia({\n      video : true,\n      audio : true\n    });\n    localStream.getTracks().forEach((track) => {\n      pc.addTrack(track, localStream);\n    });\n    let displayLocalStream = await navigator.mediaDevices.getUserMedia({\n      video : true,\n      audio : false\n    });\n    this.vidRef.current.srcObject = displayLocalStream;\n    this.vidRef.current.play();\n  }\n\n  render(){\n    return(\n      <div>\n        <video ref={this.vidRef} width=\"360\" height =\"240\" ></video>\n      </div>\n    );\n  }\n}\n\n\nclass RemoteVideo extends React.Component{\n  constructor(props){\n    super(props);\n    this.vidRef = React.createRef();\n  }\n\n  componentDidMount(){\n    this.startStream();\n  }\n\n  async startStream(){\n    pc.ontrack = (event) => {\n      event.streams[0].getTracks().forEach((track) => {\n        remoteStream.addTrack(track);\n      });\n    };\n    setInterval(()=>{this.vidRef.current.srcObject = remoteStream;\n      this.vidRef.current.play();},1000);\n  }\n\n  render(){\n    return(\n      <div>\n        <video ref={this.vidRef} width=\"360\" height =\"240\" ></video>\n      </div>\n    );\n  }\n}\n\n//for generating call\nclass GenerateCall extends React.Component{\n  constructor(props){\n    super(props);\n    this.state = {output : null};\n    this.generateCall = this.generateCall.bind(this);\n  }\n\n  async generateCall(){\n    // Reference Firestore collections for signaling\n    const callDoc = firestore.collection('calls').doc();\n    const offerCandidates = callDoc.collection('offerCandidates');\n    const answerCandidates = callDoc.collection('answerCandidates');\n\n    this.setState({ output : callDoc.id});\n\n    // Get candidates for caller, save to db\n  pc.onicecandidate = (event) => {\n    event.candidate && offerCandidates.add(event.candidate.toJSON());\n  };\n\n  // Create offer\n  const offerDescription = await pc.createOffer();\n  await pc.setLocalDescription(offerDescription);\n\n  const offer = {\n    sdp: offerDescription.sdp,\n    type: offerDescription.type,\n  };\n\n  await callDoc.set({ offer });\n\n  // Listen for remote answer\n  callDoc.onSnapshot((snapshot) => {\n    const data = snapshot.data();\n    if (!pc.currentRemoteDescription && data?.answer) {\n      const answerDescription = new RTCSessionDescription(data.answer);\n      pc.setRemoteDescription(answerDescription);\n    }\n  });\n\n  // When answered, add candidate to peer connection\n  answerCandidates.onSnapshot((snapshot) => {\n    snapshot.docChanges().forEach((change) => {\n      if (change.type === 'added') {\n        const candidate = new RTCIceCandidate(change.doc.data());\n        pc.addIceCandidate(candidate);\n      }\n    });\n  });\n\n\n  }\n\n  render(){\n    return (\n       <div>\n        <output>{this.state.output}</output>\n        <button onClick={this.generateCall} > GenerateCall</button>\n      </div>\n    );\n    }\n}\n\n//for joining a call\nclass JoinCall extends React.Component{\n  constructor(props){\n    super(props);\n    this.state ={id : null};\n    this.handleChange = this.handleChange.bind(this);\n    this.answerCall = this.answerCall.bind(this);\n  }\n\n  handleChange(event){\n    this.setState({id : event.target.value});\n  }\n\n  async answerCall(){\n  const callId = this.state.id;\n  const callDoc = firestore.collection('calls').doc(callId);\n  const answerCandidates = callDoc.collection('answerCandidates');\n  const offerCandidates = callDoc.collection('offerCandidates');\n\n  pc.onicecandidate = (event) => {\n    event.candidate && answerCandidates.add(event.candidate.toJSON());\n  };\n\n  const callData = (await callDoc.get()).data();\n\n  const offerDescription = callData.offer;\n  await pc.setRemoteDescription(new RTCSessionDescription(offerDescription));\n\n  const answerDescription = await pc.createAnswer();\n  await pc.setLocalDescription(answerDescription);\n\n  const answer = {\n    type: answerDescription.type,\n    sdp: answerDescription.sdp,\n  };\n\n  await callDoc.update({ answer });\n\n  offerCandidates.onSnapshot((snapshot) => {\n    snapshot.docChanges().forEach((change) => {\n      console.log(change);\n      if (change.type === 'added') {\n        let data = change.doc.data();\n        pc.addIceCandidate(new RTCIceCandidate(data));\n      }\n    });\n  });\n  }\n\n\n\n\n  render(){\n    return(\n      <div>\n        <input type =\"text\" value = {this.state.id} onChange = {this.handleChange} />\n        <button onClick ={this.answerCall}>Answer call</button>\n      </div>\n    );\n  }\n}\n\n\n\nclass App extends React.Component{\n\n  componentDidMount(){\n    if(!firebase.apps.length){\n      firebase.initializeApp(firebaseConfig);\n    }\n    firestore = firebase.firestore();\n  }\n\n  render(){\n    return(\n      <div>\n        <MyVideo/>\n        <br/>\n        <RemoteVideo/>\n        <br/>\n        <GenerateCall/>\n        <br/>\n        <JoinCall/>\n        \n      </div>\n    );\n  }\n}\n\n\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n\n\n\n\n"],"sourceRoot":""}